# Empty
steps:
  - name: 'gcr.io/cloud-builders/npm'
    args: ['install']
  - name: 'devillex/docker-firebase:slim'
    entrypoint: 'bash'
    args:
      [
        '-c',
        'firebase --token $$ENC_FIREBASE_TOKEN deploy --only functions --project dps-website-staging-0',
      ]
    secretEnv: ['ENC_FIREBASE_TOKEN']
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'build']
    env:
      [
        'GATSBY_HANDLE_APPLICATION_ENDPOINT=https://europe-west1-dps-website-staging-0.cloudfunctions.net/handleApplicationForm',
      ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args:
      [
        'app',
        'deploy',
        'website-staging.app.yaml',
        '--project',
        'dps-website-staging-0',
        '--log-http',
        '--verbosity',
        'debug',
      ]
secrets:
  - kmsKeyName: projects/dps-website-staging-0/locations/global/keyRings/website-staging-keyring/cryptoKeys/FIREBASE_TOKEN
    secretEnv:
      ENC_FIREBASE_TOKEN: CiQAmACp4umyNCKRsyOPSqFCt4ZMOx/wKJGvbLxal54b9luDE1gSVgCdSnK69Ylbl4WrShdUljGVTXTYyHb/FLs9IpixgXsvpm06L/2w3TOWUAT/UnoL6np2r/GBYcQltzYEp/1aEh8cMORz7guZC7m4Gbvevwihb9mXPW/N
